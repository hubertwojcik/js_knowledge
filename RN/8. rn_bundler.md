# ğŸ”¥ **Notatka: Bundler, Metro, Fiber, Memory Leaks, Bundle Optimization, Obfuscation (React Native)**

---

# ğŸ“¦ 1. Czym jest bundler?

Bundler to narzÄ™dzie, ktÃ³re:

- **zbiera caÅ‚y kod JS**,
- rozwiÄ…zuje importy,
- tworzy **jeden finalny bundle** lub kilka chunkÃ³w,
- minifikuje, usuwa martwy kod,
- optymalizuje assety.

W React Native rolÄ™ bundlera peÅ‚ni **Metro**.

---

# ğŸš‡ 2. Czym jest Metro Bundler?

Metro to **JS bundler stworzony przez Facebooka specjalnie dla React Native**.

### Cechy Metro:

âœ” zoptymalizowany pod mobile  
âœ” ultra szybki build incrementalny  
âœ” wspiera **inline requires**  
âœ” loaduje tylko rzeczy potrzebne w danej chwili  
âœ” wspiera hermes bytecode  
âœ” jest bardzo konfigurowalny przez `metro.config.js`

Inne bundlery (Webpack, Vite) NIE sÄ… uÅ¼ywane przez RN.

---

# âš™ï¸ 3. metro.config.js â€” po co jest i co daje?

To plik konfiguracyjny Metro Bundlera.

MoÅ¼esz w nim zmieniaÄ‡:

### ğŸ”§ 3.1. Transformers

- jak Metro przerabia kod
- minifikacja
- obsÅ‚uga SVG/PNG
- TypeScript / Babel plugins

### ğŸ“‚ 3.2. Watch folders

Dodawanie folderÃ³w spoza domyÅ›lnej struktury (np. monorepo).

### ğŸ§© 3.3. Resolver options

- aliasowanie moduÅ‚Ã³w    
- rozszerzenia plikÃ³w
- wykluczenia

### ğŸ§± 3.4. Asset plugins

Optymalizowanie obrazÃ³w, czcionek.

### ğŸ—‚ï¸ 3.5. Serializer

Kontrola tego, jak Metro generuje finalny bundle â€“ RZADKO uÅ¼ywane, ale bardzo waÅ¼ne w duÅ¼ych appach.

---

# ğŸ§  4. Co to jest memory leak?

**Memory leak = sytuacja, w ktÃ³rej pamiÄ™Ä‡ jest zajÄ™ta, ale nigdy nie zostaje zwolniona**, mimo Å¼e obiekt nie jest juÅ¼ potrzebny.

PrzykÅ‚ady w RN:

### ğŸ”¥ 4.1. Zostawione timery

```js
useEffect(() => {
  const interval = setInterval(...);
  return () => clearInterval(interval)
});
```

### ğŸ”¥ 4.2. NieusuniÄ™te event listenery

AppState, Dimensions, Keyboard

### ğŸ”¥ 4.3. Closures trzymajÄ…ce stare wartoÅ›ci

`async` funkcje zapisane w state

### ğŸ”¥ 4.4. Wirtualizowane listy z bÅ‚Ä™dami

DuÅ¼e listy bez poprawnej wirtualizacji â†’ RAM roÅ›nie, bo itemy nie sÄ… wyrzucane.

### ğŸ”¥ 4.5. Obrazy bez unmountu

Pobieranie duÅ¼ych bitmap â†’ crash na Androidzie.

---

# ğŸ§ª 4.6. Jak wykrywaÄ‡ memory leaks?

### Android Studio:

- **Memory Profiler**
- **Heap Dump**
- Native Memory Tracking (NMT)

### Xcode:

- **Memory Graph Debugger** (najlepsze narzÄ™dzie!)
- **Instruments â€“ Leaks**

### RN tools:

- Flipper â†’ plugin Memory
- Hermes â†’ heap capture

---

# ğŸ§µ 5. Czym jest React Fiber?

React Fiber to **architektura silnika renderowania Reacta od wersji 16+**.

Fiber to **struktura danych i scheduler**, ktÃ³ry decyduje:

- co i kiedy trzeba renderowaÄ‡
- jakie komponenty mogÄ… byÄ‡ przerwane
- jakie komponenty muszÄ… byÄ‡ synchroniczne
- jakie zadania majÄ… wyÅ¼szy priorytet

### GÅ‚Ã³wne cechy Fiber:

âœ” **Priorytety zadaÅ„** (Immediate, Normal, Low, Idle)  
âœ” **Renderowanie wspÃ³Å‚bieÅ¼ne** (Concurrent Mode â€“ RN/Fabric to wspiera!)  
âœ” **MoÅ¼liwoÅ›Ä‡ przerwania renderu**  
âœ” **OdÅ›miecanie pracy Reacta na mniejsze kroki**  
âœ” **Automatic batching** (React 18)

Fiber jest jednym z powodÃ³w, dlaczego React dziaÅ‚a pÅ‚ynniej niÅ¼ stare frameworki.

---

# âœ‚ï¸ 6. Jak redukowaÄ‡ bundle size w React Native?

Kilka metod, ktÃ³re robiÄ… OGROMNÄ„ rÃ³Å¼nicÄ™:

---

## ğŸ§¹ 6.1. UÅ¼ywaÄ‡ lazy loading (dynamic import)

```js
const HeavyScreen = React.lazy(() => import('./HeavyScreen'));
```

RN nie Å‚aduje tego ekranu na starcie.

---

## ğŸ“¦ 6.2. UnikaÄ‡ ciÄ™Å¼kich bibliotek

PrzykÅ‚ad:

Redux Toolkit = ok  
Ramda = âŒ ogromna  
Moment.js = âŒ bardzo duÅ¼y (lepiej Day.js)  
Lodash â†’ importowaÄ‡ pojedyncze funkcje

---

## ğŸª¶ 6.3. Inline requires (Metro optimization)

WÅ‚Ä…cz w `metro.config.js`:

```js
transformer: {
  getTransformOptions: async () => ({
    transform: {
      experimentalImportSupport: false,
      inlineRequires: true,
    },
  }),
},
```

Efekty:  
âœ” mniejszy initial bundle  
âœ” szybszy cold start app

---

## ğŸï¸ 6.4. Kompresja obrazÃ³w

- WebP
- AVIF
- SVG (mniejsze, jeÅ›li nie sÄ… zÅ‚oÅ¼one)

---

## ğŸ§ª 6.5. Analyze bundle using â€œreact-native-bundle-visualizerâ€

Pozwala zobaczyÄ‡, co zajmuje najwiÄ™cej.

---

# ğŸ•¶ï¸ 7. Obfuscation (mieszanie kodu)

React Native ma **2 warstwy kodu**:

- JS bundle
- natywne Android/iOS

### ğŸ” Obfuscation dotyczy gÅ‚Ã³wnie JS:

NarzÄ™dzia:

- javascript-obfuscator
- metro-minify-terser (minifikator)

### Android (natywny kod):

- uÅ¼ywa **Proguard / R8**
- zmniejsza rozmiar APK
- zaciera nazwy klas i metod

### iOS

- nie ma natywnego obfuscatora
- moÅ¼na stosowaÄ‡ SwiftShield, ale rzadko potrzebne

### Co daje obfuscation?

âœ” trudniej odczytaÄ‡ logikÄ™  
âœ” lepsza ochrona przed reverse engineering  
âœ” mniejszy rozmiar bundle (czasem)

---

# ğŸ¤ Podsumowanie do odpowiedzi na rozmowie

## ğŸ‘‰ Bundler:

> â€Bundler to narzÄ™dzie zbierajÄ…ce caÅ‚y kod JS i assety w jednÄ… paczkÄ™. W RN bundlerem jest Metro, zoptymalizowany pod mobile.â€

## ğŸ‘‰ Metro config:

> â€metro.config.js pozwala zmieniaÄ‡ sposÃ³b budowania bundle â€” aliasy, assety, transformer, cache, inline requires.â€

## ğŸ‘‰ Memory leaks:

> â€Memory leak to pamiÄ™Ä‡, ktÃ³ra zostaje zajÄ™ta mimo Å¼e obiekt nie jest juÅ¼ uÅ¼ywany â€” w RN gÅ‚Ã³wnie przez timery, listeners i closures.â€

## ğŸ‘‰ Fiber:

> â€React Fiber to silnik renderowania z priorytetami i moÅ¼liwoÅ›ciÄ… przerywania renderÃ³w â€” to fundament React 18 i Fabric w RN.â€

## ğŸ‘‰ Bundle reduction:

> â€Bundle zmniejszamy przez lazy loading, unikanie ciÄ™Å¼kich bibliotek, inline requires, kompresjÄ™ assetÃ³w i bundle analyzer.â€

## ğŸ‘‰ Obfuscation:

> â€Obfuscation miesza kod JS i natywny, utrudnia reverse engineering i czasem zmniejsza rozmiar aplikacji.â€

---

# ğŸ”¥ Chcesz teraz Å¼ebym zrobiÅ‚ z tego:

- **Å‚adny plik Markdown z emoji**
    
- albo dorobiÅ‚ do tego kolejne tematy (np. concurrency, memory leaks deep dive, schedulery)?